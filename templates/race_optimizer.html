{% extends "base.html" %}

{% block title %}Race Performance Optimizer - Marathon Training Dashboard{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card card-glassmorphism">
                <div class="card-body text-center">
                    <h1 class="text-white mb-3">
                        <i class="fas fa-rocket me-2"></i>
                        Race Performance Optimizer
                    </h1>
                    <p class="text-white-75 mb-0">
                        Advanced algorithms for optimal pacing strategies, training optimization, and race day performance maximization
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Athlete Selection -->
    <div class="row mb-4" id="athleteSelection">
        <div class="col-12">
            <div class="card card-glassmorphism">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <label for="athleteSelect" class="form-label text-white fw-bold">Select Athlete:</label>
                            <select class="form-select" id="athleteSelect">
                                <option value="">Loading athletes...</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="raceDistanceSelect" class="form-label text-white fw-bold">Race Distance:</label>
                            <select class="form-select" id="raceDistanceSelect">
                                <option value="5K">5K</option>
                                <option value="10K">10K</option>
                                <option value="Half Marathon">Half Marathon</option>
                                <option value="Marathon" selected>Marathon</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="targetTimeInput" class="form-label text-white fw-bold">Target Time (Optional):</label>
                            <input type="text" class="form-control" id="targetTimeInput" placeholder="e.g., 3:30:00 or 1:45:00">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12 text-center">
                            <button class="btn btn-primary btn-lg" id="optimizeBtn" onclick="generateOptimization()">
                                <i class="fas fa-magic me-2"></i>
                                Generate Race Optimization
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div class="row mb-4" id="loadingState" style="display: none;">
        <div class="col-12">
            <div class="card card-glassmorphism">
                <div class="card-body text-center">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5 class="text-white">Analyzing Training Data & Generating Optimization...</h5>
                    <p class="text-white-75">Processing 12 weeks of training history and calculating optimal strategies</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Optimization Results -->
    <div id="optimizationResults" style="display: none;">
        
        <!-- Performance Prediction -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card card-glassmorphism">
                    <div class="card-header">
                        <h4 class="text-white mb-0">
                            <i class="fas fa-target me-2"></i>
                            Performance Prediction
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row" id="performancePrediction">
                            <!-- Performance prediction content will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pacing Strategy -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card card-glassmorphism">
                    <div class="card-header">
                        <h4 class="text-white mb-0">
                            <i class="fas fa-stopwatch me-2"></i>
                            Optimal Pacing Strategy
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div id="pacingZones">
                                    <!-- Pacing zones will be loaded here -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="raceStrategy">
                                    <!-- Race strategy will be loaded here -->
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <h5 class="text-white mb-3">Race Splits</h5>
                                <div class="table-responsive">
                                    <table class="table table-dark table-striped" id="splitsTable">
                                        <thead>
                                            <tr>
                                                <th>Split</th>
                                                <th>Distance</th>
                                                <th>Target Pace</th>
                                                <th>Split Time</th>
                                                <th>Cumulative Time</th>
                                            </tr>
                                        </thead>
                                        <tbody id="splitsTableBody">
                                            <!-- Splits will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training Optimization -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card card-glassmorphism">
                    <div class="card-header">
                        <h4 class="text-white mb-0">
                            <i class="fas fa-chart-line me-2"></i>
                            Training Optimization
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div id="volumeRecommendations">
                                    <!-- Volume recommendations will be loaded here -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="trainingDistribution">
                                    <!-- Training distribution will be loaded here -->
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <h5 class="text-white mb-3">Key Workouts</h5>
                                <div id="keyWorkouts">
                                    <!-- Key workouts will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Race Day Recommendations -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card card-glassmorphism">
                    <div class="card-header">
                        <h4 class="text-white mb-0">
                            <i class="fas fa-calendar-day me-2"></i>
                            Race Day Strategy
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div id="warmUpStrategy">
                                    <!-- Warm-up strategy will be loaded here -->
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div id="pacingGuidance">
                                    <!-- Pacing guidance will be loaded here -->
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div id="mentalStrategy">
                                    <!-- Mental strategy will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Nutrition Strategy -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card card-glassmorphism">
                    <div class="card-header">
                        <h4 class="text-white mb-0">
                            <i class="fas fa-apple-alt me-2"></i>
                            Nutrition & Hydration Strategy
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div id="preRaceNutrition">
                                    <!-- Pre-race nutrition will be loaded here -->
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div id="duringRaceNutrition">
                                    <!-- During race nutrition will be loaded here -->
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div id="postRaceNutrition">
                                    <!-- Post-race nutrition will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fitness Metrics -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card card-glassmorphism">
                    <div class="card-header">
                        <h4 class="text-white mb-0">
                            <i class="fas fa-chart-bar me-2"></i>
                            Current Fitness Analysis
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row" id="fitnessMetrics">
                            <!-- Fitness metrics will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Error Display -->
    <div id="errorDisplay" style="display: none;">
        <div class="row">
            <div class="col-12">
                <div class="alert alert-danger" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span id="errorMessage">An error occurred while generating optimization.</span>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
// Race optimizer uses global currentAthlete from base template

// Load athletes on page load
document.addEventListener('DOMContentLoaded', function() {
    loadAthletes();
    
    // Auto-load from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const athleteId = urlParams.get('athlete_id');
    if (athleteId) {
        setTimeout(() => {
            const select = document.getElementById('athleteSelect');
            if (select && select.options.length > 0) {
                select.value = athleteId;
                currentAthlete = athleteId;
            }
        }, 1000);
    }
});

// Load athletes for selection
function loadAthletes() {
    fetch('/api/athletes')
        .then(response => response.json())
        .then(athletes => {
            const select = document.getElementById('athleteSelect');
            select.innerHTML = '<option value="">Select an athlete...</option>';
            
            if (athletes && athletes.length > 0) {
                athletes.forEach(athlete => {
                    const option = document.createElement('option');
                    option.value = athlete.id;
                    option.textContent = athlete.name;
                    select.appendChild(option);
                });
                
                // Auto-select first athlete if only one
                if (athletes.length === 1) {
                    select.value = athletes[0].id;
                    currentAthlete = athletes[0].id;
                }
            }
        })
        .catch(error => {
            console.error('Error loading athletes:', error);
            showError('Failed to load athletes');
        });
}

// Generate race optimization
function generateOptimization() {
    const athleteId = document.getElementById('athleteSelect').value;
    const raceDistance = document.getElementById('raceDistanceSelect').value;
    const targetTime = document.getElementById('targetTimeInput').value.trim();
    
    if (!athleteId) {
        showError('Please select an athlete');
        return;
    }
    
    // Show loading state
    document.getElementById('loadingState').style.display = 'block';
    document.getElementById('optimizationResults').style.display = 'none';
    document.getElementById('errorDisplay').style.display = 'none';
    
    // Disable optimize button
    const optimizeBtn = document.getElementById('optimizeBtn');
    optimizeBtn.disabled = true;
    optimizeBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Optimizing...';
    
    // Build URL with parameters
    let url = `/api/athletes/${athleteId}/race-optimization?distance=${encodeURIComponent(raceDistance)}`;
    if (targetTime) {
        url += `&target_time=${encodeURIComponent(targetTime)}`;
    }
    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showError(data.error);
            } else {
                displayOptimizationResults(data);
            }
        })
        .catch(error => {
            console.error('Error generating optimization:', error);
            showError('Failed to generate race optimization');
        })
        .finally(() => {
            // Hide loading state and re-enable button
            document.getElementById('loadingState').style.display = 'none';
            optimizeBtn.disabled = false;
            optimizeBtn.innerHTML = '<i class="fas fa-magic me-2"></i>Generate Race Optimization';
        });
}

// Display optimization results
function displayOptimizationResults(data) {
    // Performance Prediction
    displayPerformancePrediction(data.performance_prediction);
    
    // Pacing Strategy
    displayPacingStrategy(data.pacing_strategy);
    
    // Training Optimization
    displayTrainingOptimization(data.training_optimization);
    
    // Race Day Recommendations
    displayRaceDayRecommendations(data.race_day_recommendations);
    
    // Nutrition Strategy
    displayNutritionStrategy(data.nutrition_strategy);
    
    // Fitness Metrics
    displayFitnessMetrics(data.fitness_metrics);
    
    // Show results
    document.getElementById('optimizationResults').style.display = 'block';
}

function displayPerformancePrediction(prediction) {
    const container = document.getElementById('performancePrediction');
    
    container.innerHTML = `
        <div class="col-md-4">
            <div class="text-center">
                <h5 class="text-primary">Predicted Time</h5>
                <h2 class="text-white">${prediction.predicted_time_formatted}</h2>
                <p class="text-white-75">Based on current fitness</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="text-center">
                <h5 class="text-success">Best Case Scenario</h5>
                <h3 class="text-white">${prediction.best_case_formatted}</h3>
                <p class="text-white-75">Optimal conditions</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="text-center">
                <h5 class="text-warning">Conservative Estimate</h5>
                <h3 class="text-white">${prediction.worst_case_formatted}</h3>
                <p class="text-white-75">Challenging conditions</p>
            </div>
        </div>
        <div class="col-12 mt-3">
            <div class="progress" style="height: 25px;">
                <div class="progress-bar bg-success" role="progressbar" style="width: ${prediction.confidence_percentage}%">
                    ${prediction.confidence_percentage}% Confidence
                </div>
            </div>
        </div>
    `;
}

function displayPacingStrategy(pacing) {
    // Pacing Zones
    const zonesContainer = document.getElementById('pacingZones');
    zonesContainer.innerHTML = `
        <h5 class="text-white mb-3">Training Paces</h5>
        <div class="list-group list-group-flush">
            <div class="list-group-item bg-transparent border-secondary">
                <div class="d-flex justify-content-between">
                    <span class="text-white">Easy Pace:</span>
                    <span class="text-primary fw-bold">${pacing.pacing_zones.easy_pace}/km</span>
                </div>
            </div>
            <div class="list-group-item bg-transparent border-secondary">
                <div class="d-flex justify-content-between">
                    <span class="text-white">Tempo Pace:</span>
                    <span class="text-warning fw-bold">${pacing.pacing_zones.tempo_pace}/km</span>
                </div>
            </div>
            <div class="list-group-item bg-transparent border-secondary">
                <div class="d-flex justify-content-between">
                    <span class="text-white">Threshold Pace:</span>
                    <span class="text-danger fw-bold">${pacing.pacing_zones.threshold_pace}/km</span>
                </div>
            </div>
            <div class="list-group-item bg-transparent border-secondary">
                <div class="d-flex justify-content-between">
                    <span class="text-white">Target Race Pace:</span>
                    <span class="text-success fw-bold">${pacing.pacing_zones.target_pace}/km</span>
                </div>
            </div>
        </div>
    `;
    
    // Race Strategy
    const strategyContainer = document.getElementById('raceStrategy');
    strategyContainer.innerHTML = `
        <h5 class="text-white mb-3">Race Strategy</h5>
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <h6 class="text-primary">Strategy Type</h6>
                <p class="text-white">${pacing.strategy_type}</p>
                
                <h6 class="text-primary">Negative Split</h6>
                <p class="text-white">${pacing.negative_split_recommended ? 'Recommended' : 'Not recommended'}</p>
                
                <h6 class="text-primary">Target Distance</h6>
                <p class="text-white">${pacing.race_distance_km} km</p>
            </div>
        </div>
    `;
    
    // Race Splits
    const splitsBody = document.getElementById('splitsTableBody');
    splitsBody.innerHTML = '';
    
    if (pacing.splits && pacing.splits.length > 0) {
        pacing.splits.forEach(split => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${split.split_number}</td>
                <td>${split.distance_km} km</td>
                <td>${split.pace_formatted}/km</td>
                <td>${split.split_time_formatted}</td>
                <td>${split.cumulative_time_formatted}</td>
            `;
            splitsBody.appendChild(row);
        });
    }
}

function displayTrainingOptimization(training) {
    // Volume Recommendations
    const volumeContainer = document.getElementById('volumeRecommendations');
    volumeContainer.innerHTML = `
        <h5 class="text-white mb-3">Weekly Volume</h5>
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <h6 class="text-warning">Current</h6>
                        <h4 class="text-white">${training.current_weekly_volume_km} km</h4>
                    </div>
                    <div class="col-6">
                        <h6 class="text-success">Recommended</h6>
                        <h4 class="text-white">${training.recommended_weekly_volume_km} km</h4>
                    </div>
                </div>
                <div class="mt-3">
                    <small class="text-white-75">
                        Increase needed: ${training.volume_increase_needed > 0 ? '+' : ''}${training.volume_increase_needed} km/week
                    </small>
                </div>
            </div>
        </div>
    `;
    
    // Training Distribution
    const distributionContainer = document.getElementById('trainingDistribution');
    distributionContainer.innerHTML = `
        <h5 class="text-white mb-3">Training Distribution</h5>
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span class="text-white">Easy Runs</span>
                        <span class="text-success">${training.training_distribution.easy_percentage}% (${training.training_distribution.easy_volume_km} km)</span>
                    </div>
                    <div class="progress mt-1" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: ${training.training_distribution.easy_percentage}%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span class="text-white">Tempo Runs</span>
                        <span class="text-warning">${training.training_distribution.tempo_percentage}% (${training.training_distribution.tempo_volume_km} km)</span>
                    </div>
                    <div class="progress mt-1" style="height: 8px;">
                        <div class="progress-bar bg-warning" style="width: ${training.training_distribution.tempo_percentage}%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span class="text-white">Speed Work</span>
                        <span class="text-danger">${training.training_distribution.speed_percentage}% (${training.training_distribution.speed_volume_km} km)</span>
                    </div>
                    <div class="progress mt-1" style="height: 8px;">
                        <div class="progress-bar bg-danger" style="width: ${training.training_distribution.speed_percentage}%"></div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Key Workouts
    const workoutsContainer = document.getElementById('keyWorkouts');
    if (training.key_workouts && training.key_workouts.length > 0) {
        workoutsContainer.innerHTML = training.key_workouts.map(workout => `
            <div class="card bg-dark border-secondary mb-3">
                <div class="card-body">
                    <h6 class="text-primary">${workout.name}</h6>
                    <p class="text-white mb-2">${workout.description}</p>
                    <div class="d-flex justify-content-between">
                        <small class="text-warning">Target Pace: ${workout.pace_target}/km</small>
                        <small class="text-success">Frequency: ${workout.frequency}</small>
                    </div>
                </div>
            </div>
        `).join('');
    }
}

function displayRaceDayRecommendations(raceDay) {
    // Warm-up Strategy
    const warmUpContainer = document.getElementById('warmUpStrategy');
    warmUpContainer.innerHTML = `
        <h5 class="text-white mb-3">Warm-up</h5>
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <h6 class="text-primary">Duration</h6>
                <p class="text-white">${raceDay.warm_up.duration_minutes} minutes</p>
                
                <h6 class="text-primary">Structure</h6>
                <p class="text-white">${raceDay.warm_up.structure}</p>
                
                <h6 class="text-primary">Timing</h6>
                <p class="text-white">${raceDay.warm_up.timing}</p>
            </div>
        </div>
    `;
    
    // Pacing Guidance
    const pacingContainer = document.getElementById('pacingGuidance');
    pacingContainer.innerHTML = `
        <h5 class="text-white mb-3">Pacing Guidance</h5>
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <h6 class="text-primary">Start Strategy</h6>
                <p class="text-white">${raceDay.pacing_guidance.start_strategy}</p>
                
                <h6 class="text-primary">First Mile Target</h6>
                <p class="text-white">${raceDay.pacing_guidance.first_mile_target}/km</p>
                
                <h6 class="text-primary">Middle Section</h6>
                <p class="text-white">${raceDay.pacing_guidance.middle_section}</p>
                
                <h6 class="text-primary">Final Section</h6>
                <p class="text-white">${raceDay.pacing_guidance.final_section}</p>
            </div>
        </div>
    `;
    
    // Mental Strategy
    const mentalContainer = document.getElementById('mentalStrategy');
    mentalContainer.innerHTML = `
        <h5 class="text-white mb-3">Mental Strategy</h5>
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <h6 class="text-primary">Focus Points</h6>
                <ul class="text-white">
                    ${raceDay.mental_strategy.focus_points.map(point => `<li>${point}</li>`).join('')}
                </ul>
                
                <h6 class="text-primary">Mile Markers</h6>
                <p class="text-white">${raceDay.mental_strategy.mile_markers}</p>
                
                <h6 class="text-primary">Mantras</h6>
                <ul class="text-white">
                    ${raceDay.mental_strategy.mantras.map(mantra => `<li>"${mantra}"</li>`).join('')}
                </ul>
            </div>
        </div>
    `;
}

function displayNutritionStrategy(nutrition) {
    // Pre-race Nutrition
    const preRaceContainer = document.getElementById('preRaceNutrition');
    preRaceContainer.innerHTML = `
        <h5 class="text-white mb-3">Pre-Race</h5>
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <h6 class="text-primary">Timing</h6>
                <p class="text-white">${nutrition.pre_race.timing}</p>
                
                <h6 class="text-primary">Foods</h6>
                <ul class="text-white">
                    ${nutrition.pre_race.foods.map(food => `<li>${food}</li>`).join('')}
                </ul>
                
                <h6 class="text-primary">Fluids</h6>
                <p class="text-white">${nutrition.pre_race.fluids}</p>
                
                ${nutrition.pre_race.avoid ? `
                    <h6 class="text-danger">Avoid</h6>
                    <ul class="text-white">
                        ${nutrition.pre_race.avoid.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                ` : ''}
            </div>
        </div>
    `;
    
    // During Race Nutrition
    const duringRaceContainer = document.getElementById('duringRaceNutrition');
    const duringRace = nutrition.during_race;
    
    let duringRaceContent = `
        <h5 class="text-white mb-3">During Race</h5>
        <div class="card bg-dark border-secondary">
            <div class="card-body">
    `;
    
    if (typeof duringRace === 'string') {
        duringRaceContent += `<p class="text-white">${duringRace}</p>`;
    } else {
        duringRaceContent += `
            ${duringRace.carb_grams_per_hour ? `
                <h6 class="text-primary">Carbs per Hour</h6>
                <p class="text-white">${duringRace.carb_grams_per_hour}g</p>
            ` : ''}
            
            ${duringRace.fluid_ml_per_hour ? `
                <h6 class="text-primary">Fluids per Hour</h6>
                <p class="text-white">${duringRace.fluid_ml_per_hour}ml</p>
            ` : ''}
            
            ${duringRace.start_fueling ? `
                <h6 class="text-primary">Start Fueling</h6>
                <p class="text-white">${duringRace.start_fueling}</p>
            ` : ''}
            
            ${duringRace.frequency ? `
                <h6 class="text-primary">Frequency</h6>
                <p class="text-white">${duringRace.frequency}</p>
            ` : ''}
            
            ${duringRace.options ? `
                <h6 class="text-primary">Options</h6>
                <ul class="text-white">
                    ${duringRace.options.map(option => `<li>${option}</li>`).join('')}
                </ul>
            ` : ''}
        `;
    }
    
    duringRaceContent += `
            </div>
        </div>
    `;
    
    duringRaceContainer.innerHTML = duringRaceContent;
    
    // Post-race Nutrition
    const postRaceContainer = document.getElementById('postRaceNutrition');
    postRaceContainer.innerHTML = `
        <h5 class="text-white mb-3">Post-Race</h5>
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <h6 class="text-primary">Timing</h6>
                <p class="text-white">${nutrition.post_race.timing}</p>
                
                <h6 class="text-primary">Foods</h6>
                <ul class="text-white">
                    ${nutrition.post_race.foods.map(food => `<li>${food}</li>`).join('')}
                </ul>
                
                <h6 class="text-primary">Fluids</h6>
                <p class="text-white">${nutrition.post_race.fluids}</p>
                
                ${nutrition.post_race.carb_protein_ratio ? `
                    <h6 class="text-primary">Carb:Protein Ratio</h6>
                    <p class="text-white">${nutrition.post_race.carb_protein_ratio}</p>
                ` : ''}
            </div>
        </div>
    `;
}

function displayFitnessMetrics(metrics) {
    const container = document.getElementById('fitnessMetrics');
    
    container.innerHTML = `
        <div class="col-md-3">
            <div class="card bg-dark border-secondary h-100">
                <div class="card-body text-center">
                    <h5 class="text-primary">Training Volume</h5>
                    <h3 class="text-white">${metrics.total_distance_km} km</h3>
                    <p class="text-white-75">${metrics.training_period_weeks} weeks</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-dark border-secondary h-100">
                <div class="card-body text-center">
                    <h5 class="text-warning">VDOT Score</h5>
                    <h3 class="text-white">${metrics.vdot_score}</h3>
                    <p class="text-white-75">Running fitness index</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-dark border-secondary h-100">
                <div class="card-body text-center">
                    <h5 class="text-success">Consistency</h5>
                    <h3 class="text-white">${metrics.training_consistency}%</h3>
                    <p class="text-white-75">Training frequency</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-dark border-secondary h-100">
                <div class="card-body text-center">
                    <h5 class="text-info">Long Runs</h5>
                    <h3 class="text-white">${metrics.long_runs_count}</h3>
                    <p class="text-white-75">15km+ runs</p>
                </div>
            </div>
        </div>
    `;
}

function showError(message) {
    document.getElementById('errorMessage').textContent = message;
    document.getElementById('errorDisplay').style.display = 'block';
    document.getElementById('optimizationResults').style.display = 'none';
}
</script>
{% endblock %}